openapi: "3.0.1"

info:
  title: "HIV API Specification"
  description: "For using the HIV API"
  version: "v1"
  contact:
    name: "Ayup Digital"
    url: "https://ayup.agency"

servers:
- url: "https://api.hiv.test/v1/"
  description: "Dev Server"

paths:
  /users:
    post:
      tags:
        - "Users"
      summary: "Create a new user"
      operationId: "users.store"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ModifyUser"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
    get:
      tags:
        - "Users"
      summary: "List all users"
      operationId: "users.list"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserCollection"
  /users/{id}:
    get:
      tags:
        - "Users"
      summary: "Get a specific user"
      operationId: "users.show"
      parameters:
        - $ref: "#/components/parameters/id"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
    put:
      tags:
        - "Users"
      summary: "Update a specific user"
      operationId: "users.update"
      parameters:
        - $ref: "#/components/parameters/id"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ModifyUser"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
    delete:
      tags:
        - "Users"
      summart: "Delete a specific user"
      operationId: "users.destroy"
      parameters:
        - $ref: "#/components/parameters/id"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeletedResponse"

  /service-users:
    post:
      tags:
        - "Service Users"
      summary: "Create a new service user"
      operationId: "service-users.store"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ModifyServiceUser"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ServiceUser"
    get:
      tags:
        - "Service Users"
      summary: "List all service users"
      operationId: "service-users.list"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ServiceUserCollection"
  /service-users/{id}:
    get:
      tags:
        - "Service Users"
      summary: "Get a specific service user"
      operationId: "users.show"
      parameters:
        - $ref: "#/components/parameters/id"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ServiceUser"
    put:
      tags:
        - "Service Users"
      summary: "Update a specific service user"
      operationId: "service-users.update"
      parameters:
        - $ref: "#/components/parameters/id"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ModifyServiceUser"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ServiceUser"
    delete:
      tags:
        - "Service Users"
      summart: "Delete a specific service user"
      operationId: "service-users.destroy"
      parameters:
        - $ref: "#/components/parameters/id"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeletedResponse"

  /locations:
    post:
      tags:
        - "Locations"
      summary: "Create a new location"
      operationId: "locations.store"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ModifyLocation"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Location"
    get:
      tags:
        - "Locations"
      summary: "List all locations"
      operationId: "locations.list"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LocationCollection"
  /locations/{id}:
    get:
      tags:
        - "Locations"
      summary: "Get a specific location"
      operationId: "locations.show"
      parameters:
        - $ref: "#/components/parameters/id"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Location"
    put:
      tags:
        - "Locations"
      summary: "Update a specific location"
      operationId: "locations.update"
      parameters:
        - $ref: "#/components/parameters/id"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ModifyLocation"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Location"
    delete:
      tags:
        - "Locations"
      summart: "Delete a specific location"
      operationId: "locations.destroy"
      parameters:
        - $ref: "#/components/parameters/id"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeletedResponse"

  /locations/{id}/appointments:
    post:
      tags:
        - "Appointments"
      summary: "Create a new appointment"
      operationId: "appointments.store"
      parameters:
        - $ref: "#/components/parameters/id"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ModifyAppointment"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Appointment"
    get:
      tags:
        - "Appointments"
      summary: "List all appointments"
      operationId: "appointments.list"
      parameters:
        - $ref: "#/components/parameters/id"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AppointmentCollection"
  /appointments/{id}:
    get:
      tags:
        - "Appointments"
      summary: "Get a specific appointment"
      operationId: "appointments.show"
      parameters:
        - $ref: "#/components/parameters/id"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Appointment"
    put:
      tags:
        - "Appointments"
      summary: "Update a specific appointment"
      operationId: "appointments.update"
      parameters:
        - $ref: "#/components/parameters/id"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ModifyAppointment"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Appointment"
    delete:
      tags:
        - "Appointments"
      summart: "Delete a specific appointment"
      operationId: "appointments.destroy"
      parameters:
        - $ref: "#/components/parameters/id"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeletedResponse"

  /questions:
    post:
      tags:
        - "Questions"
      summary: "Create a new question"
      operationId: "questions.store"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ModifyQuestion"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Question"
    get:
      tags:
        - "Questions"
      summary: "List all questions"
      operationId: "questions.list"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/QuestionCollection"
  /questions/{id}:
    get:
      tags:
        - "Questions"
      summary: "Get a specific question"
      operationId: "questions.show"
      parameters:
        - $ref: "#/components/parameters/id"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Question"
    put:
      tags:
        - "Questions"
      summary: "Update a specific question"
      operationId: "questions.update"
      parameters:
        - $ref: "#/components/parameters/id"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ModifyQuestion"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Question"
    delete:
      tags:
        - "Questions"
      summart: "Delete a specific question"
      operationId: "questions.destroy"
      parameters:
        - $ref: "#/components/parameters/id"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeletedResponse"

  /appointments/{id}/answers:
    post:
      tags:
        - "Answers"
      summary: "Create a new answer"
      description: "This endpoint will only be invoked by an end-user who's API key will link back to them."
      operationId: "answers.store"
      parameters:
        - $ref: "#/components/parameters/id"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ModifyAnswer"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Answer"
    get:
      tags:
        - "Answers"
      summary: "List all answers"
      operationId: "answers.list"
      parameters:
        - $ref: "#/components/parameters/id"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnswerCollection"
  /answers/{id}:
    get:
      tags:
        - "Answers"
      summary: "Get a specific answer"
      operationId: "answers.show"
      parameters:
        - $ref: "#/components/parameters/id"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Answer"
    put:
      tags:
        - "Answers"
      summary: "Update a specific answer"
      description: "This endpoint will only be invoked by an end-user who's API key will link back to them."
      operationId: "answers.update"
      parameters:
        - $ref: "#/components/parameters/id"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ModifyAnswer"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Answer"
    delete:
      tags:
        - "Answers"
      summart: "Delete a specific answer"
      operationId: "answers.destroy"
      parameters:
        - $ref: "#/components/parameters/id"
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeletedResponse"

components:
  securitySchemes:
    app_id:
      type: "apiKey"
      description: "API key to authorize requests"
      name: "appid"
      in: "query"

  parameters:
    id:
      name: "id"
      in: "path"
      description: "The ID of the model"
      schema:
        type: "integer"

  schemas:
    DeletedResponse:
      type: "object"
      properties:
        message:
          type: "string"
          example: "Model successfully deleted"

    ApiResourceMeta:
      type: "object"
      properties:
        current_page:
          type: "integer"
        from:
          type: "integer"
        last_page:
          type: "integer"
        path:
          type: "string"
          example: "http://example.com/pagination"
        per_page:
          type: "integer"
        to:
          type: "integer"
        total:
          type: "integer"

    ApiResourceLinks:
      type: "object"
      properties:
        first:
          type: "string"
          example: "http://example.com/pagination?page=1"
        last:
          type: "string"
          example: "http://example.com/pagination?page=1"
        prev:
          type: "string"
          nullable: true
        next:
          type: "string"
          nullable: true

    ModifyUser:
      type: "object"
      required:
        - "name"
        - "email"
        - "password"
      properties:
        location_id:
          type: "integer"
        name:
          type: "string"
        email:
          type: "string"
          format: "email"
        password:
          type: "string"
          format: "password"

    User:
      type: "object"
      properties:
        id:
          type: "integer"
        location_id:
          type: "integer"
          nullable: true
        profile_picture_file_id:
          type: "integer"
          nullable: true
        name:
          type: "string"
        email:
          type: "string"
          format: "email"
        password:
          type: "string"
          format: "password"

    UserCollection:
      type: "object"
      properties:
        data:
          type: "array"
          items:
            $ref: "#/components/schemas/User"
        links:
          $ref: "#/components/schemas/ApiResourceLinks"
        meta:
          $ref: "#/components/schemas/ApiResourceMeta"

    ModifyServiceUser:
      type: "object"
      required:
        - "name"
        - "email"
        - "phone_number"
      properties:
        name:
          type: "string"
        email:
          type: "string"
          format: "email"
        phone_number:
          type: "string"

    ServiceUser:
      type: "object"
      properties:
        id:
          type: "integer"
        name:
          type: "string"
        email:
          type: "string"
          format: "email"
        phone_number:
          type: "string"

    ServiceUserCollection:
      type: "object"
      properties:
        data:
          type: "array"
          items:
            $ref: "#/components/schemas/ServiceUser"
        links:
          $ref: "#/components/schemas/ApiResourceLinks"
        meta:
          $ref: "#/components/schemas/ApiResourceMeta"

    ModifyLocation:
      type: "object"
      required:
        - "name"
      properties:
        name:
          type: "string"

    Location:
      type: "object"
      properties:
        id:
          type: "integer"
        name:
          type: "string"

    LocationCollection:
      type: "object"
      properties:
        data:
          type: "array"
          items:
            $ref: "#/components/schemas/Location"
        links:
          $ref: "#/components/schemas/ApiResourceLinks"
        meta:
          $ref: "#/components/schemas/ApiResourceMeta"

    ModifyAppointment:
      type: "object"
      required:
        - "start_at"
      properties:
        start_at:
          type: "string"
          example: "YYYY-MM-DD H:i:s"

    Appointment:
      type: "object"
      properties:
        id:
          type: "integer"
        location_id:
          type: "integer"
        start_at:
          type: "string"
          example: "YYYY-MM-DD H:i:s"

    AppointmentCollection:
      type: "object"
      properties:
        data:
          type: "array"
          items:
            $ref: "#/components/schemas/Appointment"
        links:
          $ref: "#/components/schemas/ApiResourceLinks"
        meta:
          $ref: "#/components/schemas/ApiResourceMeta"

    ModifyQuestion:
      type: "object"
      required:
        - "question"
      properties:
        question:
          type: "string"
        options:
          type: "array"
          items:
            $ref: "#/components/schemas/QuestionOption"
          nullable: true

    Question:
      type: "object"
      properties:
        id:
          type: "integer"
        question:
          type: "string"
        options:
          type: "array"
          items:
            $ref: "#/components/schemas/QuestionOption"

    QuestionCollection:
      type: "object"
      properties:
        data:
          type: "array"
          items:
            $ref: "#/components/schemas/Question"
        links:
          $ref: "#/components/schemas/ApiResourceLinks"
        meta:
          $ref: "#/components/schemas/ApiResourceMeta"

    QuestionOption:
      type: "object"
      properties:
        option:
          type: "string"

    ModifyAnswer:
      type: "object"
      required:
        - "question_id"
      properties:
        question_id:
          type: "integer"
        question_option_id:
          type: "integer"
          nullable: true
        answer:
          type: "string"
          nullable: true

    Answer:
      type: "object"
      properties:
        id:
          type: "integer"
        service_user_id:
          type: "integer"
        appointment_id:
          type: "integer"
        question_id:
          type: "integer"
        question_option_id:
          type: "integer"
          nullable: true
        answer:
          type: "string"
          nullable: true

    AnswerCollection:
      type: "object"
      properties:
        data:
          type: "array"
          items:
            $ref: "#/components/schemas/Answer"
        links:
          $ref: "#/components/schemas/ApiResourceLinks"
        meta:
          $ref: "#/components/schemas/ApiResourceMeta"

security:
  - app_id: []

tags:
  - name: "Users"
    description: "Backend users"
  - name: "Service Users"
    description: "End-users consuming the service"
  - name: "Locations"
    description: "Clinic locations"
  - name: "Appointments"
    description: "Appointments at locations"
  - name: "Questions"
    description: "Screening questions to get an appointment booked"
  - name: "Answers"
    description: "Service user answers to screening questions"

externalDocs:
  description: "External Doc Website"
  url: "https://ayup.agency"
