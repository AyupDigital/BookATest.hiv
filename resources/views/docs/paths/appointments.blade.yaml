clinics.clinic_id.appointments:
  get:
    tags:
      - "Appointments"
    summary: "List all the appointments at a clinic"
    description: |
      This enpoint returns several responses depending on the caller:

      ### Accessed From Service User
      When this endpoint is accessed from a service user (no authentication), it will always return only the
      appointments that are available.

      ### Accessed From User
      When access by an authenticated user, they can specify if they want to view all appointments or only available
      appointments by specifying the `format` parameter in the query string.

      ### Calendar Feed
      To get a calendar feed of all appointments in `.ics` format:
      - the `format` parameter of the query string must be set to `ics`
      - and the `calendar_feed_token` must be provided (which is unique to a specific user)
    operationId: "clinics.appointments.index"
    security: []
    parameters:
      - $ref: "/docs/parameters/id.yaml#/clinic_id"
      - name: "format"
        in: "query"
        description: "The format of the appointments"
        schema:
          type: "string"
          enum: ["json", "ics"]
          default: "json"
      - name: "calendar_feed_token"
        in: "query"
        description: "The user's calendar feed token - required if the format is set to `ics`"
        schema:
          type: "string"
      - name: "available"
        in: "query"
        description: >
          If only available appointments should be returned. If the user is not authenticated, then they can only see
          appointments which are available.
        schema:
          type: "boolean"
    responses:
      200:
        description: "Successful response"
        content:
          application/json:
            schema:
              $ref: "/docs/schemas/appointment.yaml#/AppointmentCollection"
          text/calendar:
  post:
    tags:
      - "Appointments"
    summary: "Create a new appointment"
    operationId: "clinics.appointments.store"
    parameters:
      - $ref: "/docs/parameters/id.yaml#/clinic_id"
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "/docs/schemas/appointment.yaml#/ModifyAppointment"
    responses:
      200:
        description: "Successful response"
        content:
          application/json:
            schema:
              $ref: "/docs/schemas/appointment.yaml#/Appointment"

users.user_id.appointments:
  get:
    tags:
      - "Appointments"
    summary: "List all appointments for a specified user"
    operationId: "users.appointments.list"
    parameters:
      - $ref: "/docs/parameters/id.yaml#/user_id"
      - name: "format"
        in: "query"
        description: "The format of the appointments"
        schema:
          type: "string"
          enum: ["json", "ics"]
          default: "json"
    responses:
      200:
        description: "Successful response"
        content:
          application/json:
            schema:
              $ref: "/docs/schemas/appointment.yaml#/AppointmentCollection"
          text/calendar:

service-users.service_user_uuid.appointments:
  get:
    tags:
      - "Appointments"
    summary: "List all appointments for a specified service user"
    operationId: "service-users.appointments.list"
    parameters:
      - $ref: "/docs/parameters/id.yaml#/service_user_uuid"
    responses:
      200:
        description: "Successful response"
        content:
          application/json:
            schema:
              $ref: "/docs/schemas/appointment.yaml#/AppointmentCollection"

appointments:
  get:
    tags:
      - "Appointments"
    summary: "List all appointments"
    operationId: "appointments.list"
    responses:
      200:
        description: "Successful response"
        content:
          application/json:
            schema:
              $ref: "/docs/schemas/appointment.yaml#/AppointmentCollection"

appointments.appointment_id:
  get:
    tags:
      - "Appointments"
    summary: "Get a specific appointment"
    operationId: "appointments.show"
    parameters:
      - $ref: "/docs/parameters/id.yaml#/appointment_id"
    responses:
      200:
        description: "Successful response"
        content:
          application/json:
            schema:
              $ref: "/docs/schemas/appointment.yaml#/Appointment"
  put:
    tags:
      - "Appointments"
    summary: "Update a specific appointment"
    operationId: "appointments.update"
    parameters:
      - $ref: "/docs/parameters/id.yaml#/appointment_id"
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "/docs/schemas/appointment.yaml#/ModifyAppointment"
    responses:
      200:
        description: "Successful response"
        content:
          application/json:
            schema:
              $ref: "/docs/schemas/appointment.yaml#/Appointment"
  delete:
    tags:
      - "Appointments"
    summary: "Delete a specific appointment"
    description: >
      An appointment can only be deleted if it has not been booked by a service user. If an appointment has been booked,
      it must first be cancelled before you can delete it.
    operationId: "appointments.destroy"
    parameters:
      - $ref: "/docs/parameters/id.yaml#/appointment_id"
    responses:
      200:
        description: "Successful response"
        content:
          application/json:
            schema:
              $ref: "/docs/schemas/responses.yaml#/DeletedResponse"

appointments.appointment_id.cancel:
  put:
    tags:
      - "Appointments"
    summary: "Cancel a specific appointment"
    description: |
      Removes the booking against the specified appointment.

      If the service user is cancelling their own appointment then the `service_user_uuid` parameter must be provided.
    operationId: "appointments.cancel.update"
    security: []
    parameters:
      - $ref: "/docs/parameters/id.yaml#/appointment_id"
    requestBody:
      content:
        application/json:
          schema:
            type: "object"
            required:
              - "service_user_uuid"
            properties:
              service_user_uuid:
                type: "string"
    responses:
      200:
        description: "Successful response"
        content:
          application/json:
            schema:
              $ref: "/docs/schemas/appointment.yaml#/Appointment"
